<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª PWA - ARKA PREMIUM</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Vazir', sans-serif;
            padding: 20px;
            background: #f0f0f0;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #667eea;
            margin-bottom: 20px;
        }
        .test-item {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-right: 4px solid #667eea;
        }
        .test-item h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-top: 10px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #5a67d8;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª ØªØ³Øª PWA - ARKA PREMIUM</h1>
        <p>Ø§ÛŒÙ† ØµÙØ­Ù‡ Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ PWA Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>
        
        <div class="test-item">
            <h3>1. Ø¨Ø±Ø±Ø³ÛŒ HTTPS</h3>
            <p>PWA ÙÙ‚Ø· Ø±ÙˆÛŒ HTTPS Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (ÛŒØ§ localhost Ø¨Ø±Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡)</p>
            <div id="https-status"></div>
        </div>
        
        <div class="test-item">
            <h3>2. Ø¨Ø±Ø±Ø³ÛŒ Service Worker</h3>
            <p>Service Worker Ø¨Ø±Ø§ÛŒ Ù‚Ø§Ø¨Ù„ÛŒØª Ø¢ÙÙ„Ø§ÛŒÙ† Ø¶Ø±ÙˆØ±ÛŒ Ø§Ø³Øª</p>
            <button onclick="checkServiceWorker()">Ø¨Ø±Ø±Ø³ÛŒ Service Worker</button>
            <div id="sw-status"></div>
        </div>
        
        <div class="test-item">
            <h3>3. Ø¨Ø±Ø±Ø³ÛŒ Manifest</h3>
            <p>ÙØ§ÛŒÙ„ manifest.json Ø¨Ø±Ø§ÛŒ Ù†ØµØ¨ PWA Ø¶Ø±ÙˆØ±ÛŒ Ø§Ø³Øª</p>
            <button onclick="checkManifest()">Ø¨Ø±Ø±Ø³ÛŒ Manifest</button>
            <div id="manifest-status"></div>
        </div>
        
        <div class="test-item">
            <h3>4. ØªØ³Øª IndexedDB</h3>
            <p>Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø±</p>
            <button onclick="testIndexedDB()">ØªØ³Øª Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø§Ø¯Ù‡</button>
            <button onclick="readIndexedDB()">Ø®ÙˆØ§Ù†Ø¯Ù† Ø¯Ø§Ø¯Ù‡</button>
            <div id="db-status"></div>
        </div>
        
        <div class="test-item">
            <h3>5. ØªØ³Øª Cache API</h3>
            <p>Ú©Ø´ Ú©Ø±Ø¯Ù† Ù…Ù†Ø§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¢ÙÙ„Ø§ÛŒÙ†</p>
            <button onclick="testCache()">ØªØ³Øª Cache</button>
            <div id="cache-status"></div>
        </div>
        
        <div class="test-item">
            <h3>6. Ù‚Ø§Ø¨Ù„ÛŒØª Ù†ØµØ¨</h3>
            <p>Ø¢ÛŒØ§ PWA Ù‚Ø§Ø¨Ù„ Ù†ØµØ¨ Ø§Ø³ØªØŸ</p>
            <button onclick="checkInstallability()">Ø¨Ø±Ø±Ø³ÛŒ Ù‚Ø§Ø¨Ù„ÛŒØª Ù†ØµØ¨</button>
            <div id="install-status"></div>
        </div>
        
        <div class="test-item">
            <h3>7. ÙˆØ¶Ø¹ÛŒØª Ø´Ø¨Ú©Ù‡</h3>
            <p>Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¢Ù†Ù„Ø§ÛŒÙ†/Ø¢ÙÙ„Ø§ÛŒÙ†</p>
            <div id="network-status"></div>
        </div>
    </div>

    <script>
        // Check HTTPS
        function checkHTTPS() {
            const isSecure = location.protocol === 'https:' || location.hostname === 'localhost';
            const status = document.getElementById('https-status');
            if (isSecure) {
                status.innerHTML = '<span class="status success">âœ“ Ø§ØªØµØ§Ù„ Ø§Ù…Ù† (HTTPS)</span>';
            } else {
                status.innerHTML = '<span class="status error">âœ— Ù†ÛŒØ§Ø² Ø¨Ù‡ HTTPS</span>';
            }
        }

        // Check Service Worker
        async function checkServiceWorker() {
            const status = document.getElementById('sw-status');
            
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.getRegistration();
                    if (registration) {
                        status.innerHTML = `
                            <span class="status success">âœ“ Service Worker Ù†ØµØ¨ Ø´Ø¯Ù‡</span>
                            <div class="result">
Scope: ${registration.scope}
Active: ${registration.active ? 'Yes' : 'No'}
Waiting: ${registration.waiting ? 'Yes' : 'No'}
Installing: ${registration.installing ? 'Yes' : 'No'}
                            </div>
                        `;
                    } else {
                        status.innerHTML = '<span class="status warning">âš  Service Worker Ù†ØµØ¨ Ù†Ø´Ø¯Ù‡</span>';
                    }
                } catch (error) {
                    status.innerHTML = `<span class="status error">âœ— Ø®Ø·Ø§: ${error.message}</span>`;
                }
            } else {
                status.innerHTML = '<span class="status error">âœ— Ù…Ø±ÙˆØ±Ú¯Ø± Ø§Ø² Service Worker Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯</span>';
            }
        }

        // Check Manifest
        async function checkManifest() {
            const status = document.getElementById('manifest-status');
            
            try {
                const response = await fetch('/manifest.json');
                if (response.ok) {
                    const manifest = await response.json();
                    status.innerHTML = `
                        <span class="status success">âœ“ Manifest ÛŒØ§ÙØª Ø´Ø¯</span>
                        <div class="result">
Name: ${manifest.name}
Short Name: ${manifest.short_name}
Display: ${manifest.display}
Theme Color: ${manifest.theme_color}
Icons: ${manifest.icons ? manifest.icons.length : 0} Ø¹Ø¯Ø¯
                        </div>
                    `;
                } else {
                    status.innerHTML = '<span class="status error">âœ— Manifest ÛŒØ§ÙØª Ù†Ø´Ø¯</span>';
                }
            } catch (error) {
                status.innerHTML = `<span class="status error">âœ— Ø®Ø·Ø§: ${error.message}</span>`;
            }
        }

        // Test IndexedDB
        async function testIndexedDB() {
            const status = document.getElementById('db-status');
            
            try {
                const request = indexedDB.open('TestDB', 1);
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains('test')) {
                        db.createObjectStore('test', { keyPath: 'id' });
                    }
                };
                
                request.onsuccess = (event) => {
                    const db = event.target.result;
                    const transaction = db.transaction(['test'], 'readwrite');
                    const store = transaction.objectStore('test');
                    
                    const data = {
                        id: 1,
                        message: 'ØªØ³Øª Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø± ' + new Date().toLocaleString('fa-IR'),
                        timestamp: Date.now()
                    };
                    
                    const addRequest = store.put(data);
                    
                    addRequest.onsuccess = () => {
                        status.innerHTML = `
                            <span class="status success">âœ“ Ø¯Ø§Ø¯Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯</span>
                            <div class="result">${JSON.stringify(data, null, 2)}</div>
                        `;
                    };
                    
                    addRequest.onerror = () => {
                        status.innerHTML = '<span class="status error">âœ— Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø§Ø¯Ù‡</span>';
                    };
                };
                
                request.onerror = () => {
                    status.innerHTML = '<span class="status error">âœ— Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø¯ÛŒØªØ§Ø¨ÛŒØ³</span>';
                };
            } catch (error) {
                status.innerHTML = `<span class="status error">âœ— Ø®Ø·Ø§: ${error.message}</span>`;
            }
        }

        // Read from IndexedDB
        async function readIndexedDB() {
            const status = document.getElementById('db-status');
            
            try {
                const request = indexedDB.open('TestDB', 1);
                
                request.onsuccess = (event) => {
                    const db = event.target.result;
                    const transaction = db.transaction(['test'], 'readonly');
                    const store = transaction.objectStore('test');
                    const getRequest = store.get(1);
                    
                    getRequest.onsuccess = () => {
                        if (getRequest.result) {
                            status.innerHTML = `
                                <span class="status success">âœ“ Ø¯Ø§Ø¯Ù‡ Ø®ÙˆØ§Ù†Ø¯Ù‡ Ø´Ø¯</span>
                                <div class="result">${JSON.stringify(getRequest.result, null, 2)}</div>
                            `;
                        } else {
                            status.innerHTML = '<span class="status warning">âš  Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</span>';
                        }
                    };
                    
                    getRequest.onerror = () => {
                        status.innerHTML = '<span class="status error">âœ— Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† Ø¯Ø§Ø¯Ù‡</span>';
                    };
                };
            } catch (error) {
                status.innerHTML = `<span class="status error">âœ— Ø®Ø·Ø§: ${error.message}</span>`;
            }
        }

        // Test Cache API
        async function testCache() {
            const status = document.getElementById('cache-status');
            
            if ('caches' in window) {
                try {
                    const cacheName = 'test-cache-v1';
                    const cache = await caches.open(cacheName);
                    
                    // Add a test resource to cache
                    await cache.add('/test.html');
                    
                    // Check if it's cached
                    const response = await cache.match('/test.html');
                    
                    if (response) {
                        status.innerHTML = `
                            <span class="status success">âœ“ Cache API Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯</span>
                            <div class="result">
Cache Name: ${cacheName}
Cached URL: /test.html
Status: ${response.status}
                            </div>
                        `;
                    } else {
                        status.innerHTML = '<span class="status error">âœ— Ø®Ø·Ø§ Ø¯Ø± Ú©Ø´ Ú©Ø±Ø¯Ù†</span>';
                    }
                } catch (error) {
                    status.innerHTML = `<span class="status error">âœ— Ø®Ø·Ø§: ${error.message}</span>`;
                }
            } else {
                status.innerHTML = '<span class="status error">âœ— Ù…Ø±ÙˆØ±Ú¯Ø± Ø§Ø² Cache API Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯</span>';
            }
        }

        // Check Installability
        function checkInstallability() {
            const status = document.getElementById('install-status');
            
            let deferredPrompt;
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                status.innerHTML = '<span class="status success">âœ“ PWA Ù‚Ø§Ø¨Ù„ Ù†ØµØ¨ Ø§Ø³Øª</span>';
            });
            
            // Check if already installed
            if (window.matchMedia('(display-mode: standalone)').matches) {
                status.innerHTML = '<span class="status success">âœ“ PWA Ù†ØµØ¨ Ø´Ø¯Ù‡ Ø§Ø³Øª</span>';
            } else {
                status.innerHTML = '<span class="status warning">âš  Ù…Ù†ØªØ¸Ø± Ø¨Ø±Ø±Ø³ÛŒ Ù‚Ø§Ø¨Ù„ÛŒØª Ù†ØµØ¨...</span>';
            }
        }

        // Check Network Status
        function checkNetworkStatus() {
            const status = document.getElementById('network-status');
            
            function updateStatus() {
                if (navigator.onLine) {
                    status.innerHTML = '<span class="status success">âœ“ Ø¢Ù†Ù„Ø§ÛŒÙ†</span>';
                } else {
                    status.innerHTML = '<span class="status warning">âš  Ø¢ÙÙ„Ø§ÛŒÙ†</span>';
                }
            }
            
            window.addEventListener('online', updateStatus);
            window.addEventListener('offline', updateStatus);
            
            updateStatus();
        }

        // Run initial checks
        window.onload = () => {
            checkHTTPS();
            checkNetworkStatus();
            checkInstallability();
        };
    </script>
</body>
</html>
